(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{393:function(e,t,s){Promise.resolve().then(s.bind(s,5571))},5571:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return K}});var a=s(3827),r=s(4090),l=s(8727),i=s(5005),n=s(94),d=s(7307),o=s(6329),c=s(9733),x=s(4108),m=s(2235),u=s(3854),p=s(2244),g=s(1213),h=s(684),b=s(1652);function f(e){let{isOpen:t,onClose:s,onSuccess:l}=e,[i,n]=(0,r.useState)(!1),[d,o]=(0,r.useState)(""),[c,f]=(0,r.useState)(""),[j,v]=(0,r.useState)(""),[y,N]=(0,r.useState)(!1),[w,D]=(0,r.useState)(""),{signIn:C,signUp:k}=(0,x.useAuth)(),S=async e=>{e.preventDefault(),D(""),N(!0);try{let e=i?await k(d,c,j):await C(d,c);e.success?(null==l||l(),s()):D(e.error||"操作失败")}catch(e){D(e.message||"操作失败")}finally{N(!1)}};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl max-w-md w-full shadow-2xl overflow-hidden",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 p-6 relative",children:[(0,a.jsx)("button",{onClick:s,className:"absolute top-4 right-4 p-2 hover:bg-white/20 rounded-full transition",children:(0,a.jsx)(m.Z,{size:20,className:"text-white"})}),(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto bg-white/20 rounded-full flex items-center justify-center mb-3",children:i?(0,a.jsx)(u.Z,{size:32}):(0,a.jsx)(p.Z,{size:32})}),(0,a.jsx)("h2",{className:"text-2xl font-bold",children:i?"创建账户":"欢迎回来"}),(0,a.jsx)("p",{className:"text-indigo-100 mt-1",children:i?"开始你的旅行分账之旅":"登录继续管理旅行"})]})]}),(0,a.jsxs)("form",{onSubmit:S,className:"p-6 space-y-4",children:[w&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl text-sm",children:["⚠️ ",w]}),i&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,a.jsx)(g.Z,{size:16,className:"inline mr-1"}),"姓名"]}),(0,a.jsx)("input",{type:"text",value:j,onChange:e=>v(e.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition text-gray-900 placeholder-gray-400",placeholder:"你的姓名"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,a.jsx)(h.Z,{size:16,className:"inline mr-1"}),"邮箱"]}),(0,a.jsx)("input",{type:"email",value:d,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition text-gray-900 placeholder-gray-400",placeholder:"your@email.com",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,a.jsx)(b.Z,{size:16,className:"inline mr-1"}),"密码"]}),(0,a.jsx)("input",{type:"password",value:c,onChange:e=>f(e.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition text-gray-900 placeholder-gray-400",placeholder:"至少 6 位",minLength:6,required:!0})]}),(0,a.jsx)("button",{type:"submit",disabled:y,className:"w-full py-3 rounded-xl font-semibold text-white transition ".concat(y?"bg-gray-400 cursor-not-allowed":"bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 hover:from-indigo-600 hover:via-purple-600 hover:to-pink-600 shadow-lg"),children:y?"处理中...":i?"创建账户":"登录"}),(0,a.jsx)("div",{className:"text-center pt-4 border-t",children:(0,a.jsxs)("p",{className:"text-gray-600 text-sm",children:[i?"已有账户？":"还没有账户？",(0,a.jsx)("button",{type:"button",onClick:()=>{n(!i),D("")},className:"ml-2 text-indigo-600 font-semibold hover:underline",children:i?"登录":"注册"})]})})]})]})}):null}var j=s(9910),v=s(1049);function y(){var e,t,s,l,i;let{user:n,profile:d,signOut:o,loading:c}=(0,x.useAuth)(),[m,u]=(0,r.useState)(!1),[p,h]=(0,r.useState)(!1);return c?(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 animate-pulse"}):n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>h(!p),className:"flex items-center gap-2 px-3 py-2 bg-white/20 backdrop-blur rounded-xl hover:bg-white/30 transition",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-indigo-400 to-purple-400 rounded-full flex items-center justify-center text-white font-bold",children:(null==d?void 0:null===(t=d.full_name)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.toUpperCase())||(null===(l=n.email)||void 0===l?void 0:null===(s=l[0])||void 0===s?void 0:s.toUpperCase())||"U"}),(0,a.jsx)("span",{className:"text-sm font-medium text-white hidden sm:block",children:(null==d?void 0:d.full_name)||(null===(i=n.email)||void 0===i?void 0:i.split("@")[0])})]}),p&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>h(!1)}),(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg z-20 overflow-hidden",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-800",children:(null==d?void 0:d.full_name)||"用户"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 truncate",children:n.email})]}),(0,a.jsxs)("button",{onClick:()=>{h(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[(0,a.jsx)(j.Z,{size:16}),"账户设置"]}),(0,a.jsxs)("button",{onClick:async()=>{await o(),h(!1)},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center gap-2 border-t",children:[(0,a.jsx)(v.Z,{size:16}),"退出登录"]})]})]})]}),(0,a.jsx)(f,{isOpen:m,onClose:()=>u(!1)})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:()=>u(!0),className:"flex items-center gap-2 px-4 py-2 bg-white/20 backdrop-blur rounded-xl hover:bg-white/30 transition",children:[(0,a.jsx)(g.Z,{size:20}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"登录"})]}),(0,a.jsx)(f,{isOpen:m,onClose:()=>u(!1)})]})}function N(e){let{trips:t,onCreateTrip:s,onSelectTrip:r}=e;return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-100 via-purple-50 to-pink-100",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 text-white shadow-xl",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-3 bg-white/20 rounded-2xl",children:(0,a.jsx)(l.Z,{size:32})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"✈️ Trip Splitter"}),(0,a.jsx)("p",{className:"text-white/80 mt-1",children:"旅游分账，轻松结算"})]})]}),(0,a.jsx)(y,{})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 mt-6",children:[(0,a.jsxs)("div",{className:"bg-white/20 backdrop-blur rounded-xl p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.length}),(0,a.jsx)("div",{className:"text-sm text-white/80",children:"旅行"})]}),(0,a.jsxs)("div",{className:"bg-white/20 backdrop-blur rounded-xl p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:t.reduce((e,t)=>e+(t.participantCount||0),0)}),(0,a.jsx)("div",{className:"text-sm text-white/80",children:"参与者"})]}),(0,a.jsxs)("div",{className:"bg-white/20 backdrop-blur rounded-xl p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold",children:"\xa50"}),(0,a.jsx)("div",{className:"text-sm text-white/80",children:"总支出"})]})]})]})}),(0,a.jsxs)("div",{className:"p-4 max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[(0,a.jsx)(i.Z,{size:24,className:"text-indigo-500"}),"我的旅行"]}),(0,a.jsxs)("button",{onClick:s,className:"flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl hover:from-indigo-600 hover:to-purple-600 shadow-lg hover:shadow-xl transition transform hover:scale-105",children:[(0,a.jsx)(n.Z,{size:20}),"创建旅行"]})]}),0===t.length?(0,a.jsxs)("div",{className:"text-center py-16 bg-white rounded-3xl shadow-lg",children:[(0,a.jsx)("div",{className:"w-24 h-24 mx-auto bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(i.Z,{size:48,className:"text-indigo-400"})}),(0,a.jsx)("p",{className:"text-gray-600 text-lg font-medium mb-2",children:"还没有旅行"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"创建一个旅行开始分账"})]}):(0,a.jsx)("div",{className:"space-y-4",children:t.map(e=>(0,a.jsxs)("div",{onClick:()=>r(e),className:"bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all cursor-pointer overflow-hidden group",children:[(0,a.jsx)("div",{className:"h-2 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"}),(0,a.jsx)("div",{className:"p-5",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-800 group-hover:text-indigo-600 transition",children:e.name}),(e.startDate||e.endDate)&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-3 text-sm text-gray-500",children:[(0,a.jsx)(d.Z,{size:16}),(0,a.jsxs)("span",{children:[e.startDate&&new Date(e.startDate).toLocaleDateString("zh-CN")," - ",e.endDate&&new Date(e.endDate).toLocaleDateString("zh-CN")]})]}),void 0!==e.participantCount&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsx)("div",{className:"flex -space-x-2",children:[...Array(Math.min(3,e.participantCount))].map((e,t)=>(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-indigo-400 to-purple-400 border-2 border-white"},t))}),e.participantCount>3&&(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["+",e.participantCount-3]}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"人参与"})]})]}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,a.jsx)("div",{className:"p-3 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-xl group-hover:scale-110 transition",children:(0,a.jsx)(o.Z,{size:24,className:"text-indigo-500"})}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[(0,a.jsx)(c.Z,{size:14}),(0,a.jsx)("span",{children:"点击查看"})]})]})]})})]},e.id))})]})]})}var w=s(8219),D=s(6490),C=s(4059),k=s(9295),S=s(489);function I(e){let{expenses:t,onAddExpense:s,onEditExpense:r,onDeleteExpense:l}=e,i=e=>{switch(e){case"餐饮":return"\uD83C\uDF7D️";case"交通":return"\uD83D\uDE97";case"住宿":return"\uD83C\uDFE8";case"门票":return"\uD83C\uDFAB";case"购物":return"\uD83D\uDECD️";case"其他":return"\uD83D\uDCDD";default:return"\uD83D\uDCB0"}},d=e=>{let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/864e5);return 0===s?"今天":1===s?"昨天":s<7?"".concat(s,"天前"):t.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},o=t.reduce((e,t)=>e+(t.amountInBase||t.amount),0);return(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-emerald-500 to-teal-500 p-5",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,a.jsx)(w.Z,{size:24}),"支出记录"]}),(0,a.jsxs)("p",{className:"text-emerald-100 text-sm mt-1",children:["共 ",t.length," 笔 \xb7 总计 ",o.toFixed(2)," 元"]})]}),(0,a.jsxs)("button",{onClick:s,className:"flex items-center gap-2 px-5 py-3 bg-white text-emerald-600 rounded-xl font-semibold hover:bg-emerald-50 transition shadow-lg",children:[(0,a.jsx)(n.Z,{size:20}),"添加支出"]})]})}),(0,a.jsx)("div",{className:"divide-y divide-gray-100",children:0===t.length?(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 mx-auto bg-gradient-to-br from-emerald-100 to-teal-100 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(w.Z,{size:40,className:"text-emerald-400"})}),(0,a.jsx)("p",{className:"text-gray-600 font-medium mb-2",children:"还没有支出记录"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm mb-4",children:'点击"添加支出"开始记账'}),(0,a.jsx)("button",{onClick:s,className:"px-6 py-2 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl hover:from-emerald-600 hover:to-teal-600 transition",children:"添加第一笔支出"})]}):t.map(e=>(0,a.jsx)("div",{className:"p-5 hover:bg-gradient-to-r hover:from-gray-50 hover:to-emerald-50 transition group",children:(0,a.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,a.jsxs)("div",{className:"flex gap-4 flex-1",children:[(0,a.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-gray-100 to-gray-200 rounded-2xl flex items-center justify-center text-2xl shadow-sm group-hover:scale-110 transition",children:i(e.category)}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-bold text-gray-800 text-lg",children:e.description}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3 mt-2 text-sm",children:[(0,a.jsx)("span",{className:"px-3 py-1 bg-gradient-to-r from-blue-100 to-indigo-100 text-blue-700 rounded-full font-medium",children:e.category}),(0,a.jsxs)("span",{className:"flex items-center gap-1 text-gray-500",children:[(0,a.jsx)(D.Z,{size:14}),d(e.date)]}),(0,a.jsxs)("span",{className:"flex items-center gap-1 text-gray-500",children:[(0,a.jsx)(g.Z,{size:14}),e.payerName," 支付"]}),e.familyName&&(0,a.jsxs)("span",{className:"flex items-center gap-1 text-gray-500",children:[(0,a.jsx)(C.Z,{size:14}),e.familyName]})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2 text-xs",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"分摊方式："}),(0,a.jsx)("span",{className:"px-2 py-1 rounded-lg font-medium ".concat("all"===e.splitType?"bg-green-100 text-green-700":"families"===e.splitType?"bg-purple-100 text-purple-700":"bg-orange-100 text-orange-700"),children:"all"===e.splitType?"\uD83D\uDC65 全体分摊":"families"===e.splitType?"\uD83C\uDFE0 指定 Family":"\uD83D\uDC64 指定人员"})]})]})]}),(0,a.jsxs)("div",{className:"text-right flex-shrink-0",children:[(0,a.jsxs)("p",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-600",children:["CNY"===e.currency?"\xa5":e.currency," ",e.amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),"CNY"!==e.currency&&e.amountInBase&&(0,a.jsxs)("p",{className:"text-sm text-gray-400 mt-1",children:["≈ \xa5",e.amountInBase.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-3 opacity-0 group-hover:opacity-100 transition",children:[(0,a.jsx)("button",{onClick:()=>r(e),className:"p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 transition",title:"编辑",children:(0,a.jsx)(k.Z,{size:16})}),(0,a.jsx)("button",{onClick:()=>l(e.id),className:"p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition",title:"删除",children:(0,a.jsx)(S.Z,{size:16})})]})]})]})},e.id))}),t.length>0&&(0,a.jsx)("div",{className:"bg-gradient-to-r from-gray-50 to-emerald-50 p-4 border-t border-gray-100",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,a.jsx)("span",{className:"font-medium",children:t.length})," 笔支出"]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"总支出"}),(0,a.jsxs)("div",{className:"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-600",children:["\xa5",o.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})})]})}var z=s(7252),F=s(775),Z=s(8025),E=s(6578);function A(e){let{families:t,familyBalances:s,settlements:r,baseCurrency:l}=e,i=e=>{var s;return(null===(s=t.find(t=>t.id===e))||void 0===s?void 0:s.name)||e},n=Array.from(s.values()).filter(e=>e>0).reduce((e,t)=>e+t,0);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 rounded-2xl shadow-xl p-6 text-white",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)(z.Z,{size:28}),(0,a.jsx)("h3",{className:"text-xl font-bold",children:"结算总览"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white/20 backdrop-blur rounded-xl p-4 text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:t.length}),(0,a.jsx)("div",{className:"text-sm text-blue-100",children:"Family"})]}),(0,a.jsxs)("div",{className:"bg-white/20 backdrop-blur rounded-xl p-4 text-center",children:[(0,a.jsx)("div",{className:"text-3xl font-bold",children:r.length}),(0,a.jsx)("div",{className:"text-sm text-blue-100",children:"待结算"})]}),(0,a.jsxs)("div",{className:"bg-white/20 backdrop-blur rounded-xl p-4 text-center",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold",children:["\xa5",n.toFixed(0)]}),(0,a.jsx)("div",{className:"text-sm text-blue-100",children:"流转金额"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[(0,a.jsx)(c.Z,{size:20,className:"text-blue-500"}),"各 Family 余额"]}),(0,a.jsx)("div",{className:"space-y-3",children:Array.from(s.entries()).map(e=>{var s;let[r,n]=e;return(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 rounded-xl transition hover:scale-[1.02] ".concat(n>0?"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200":n<0?"bg-gradient-to-r from-red-50 to-orange-50 border border-red-200":"bg-gray-50 border border-gray-200"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center ".concat(n>0?"bg-gradient-to-br from-green-400 to-emerald-500":n<0?"bg-gradient-to-br from-red-400 to-orange-500":"bg-gradient-to-br from-gray-300 to-gray-400"),children:n>0?(0,a.jsx)(c.Z,{size:24,className:"text-white"}):n<0?(0,a.jsx)(F.Z,{size:24,className:"text-white"}):(0,a.jsx)("span",{className:"text-white text-xl",children:"-"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold text-gray-800 text-lg",children:i(r)}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[(null===(s=t.find(e=>e.id===r))||void 0===s?void 0:s.members.length)||0," 人"]})]})]}),(0,a.jsxs)("div",{className:"text-2xl font-bold ".concat(n>0?"text-transparent bg-clip-text bg-gradient-to-r from-green-600 to-emerald-600":n<0?"text-transparent bg-clip-text bg-gradient-to-r from-red-600 to-orange-600":"text-gray-400"),children:[n>0?"+":"",n.toFixed(2)," ",l]})]},r)})})]}),r.length>0?(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[(0,a.jsx)(Z.Z,{size:20,className:"text-indigo-500"}),"结算方案"]}),(0,a.jsx)("div",{className:"space-y-3",children:r.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-5 bg-gradient-to-r from-indigo-50 via-purple-50 to-pink-50 rounded-xl border border-indigo-100 hover:shadow-md transition",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,a.jsxs)("div",{className:"text-right flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)("span",{className:"font-bold text-red-600 text-lg",children:i(e.fromFamily)}),(0,a.jsx)("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(F.Z,{size:16,className:"text-red-500"})})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"应付"})]}),(0,a.jsx)("div",{className:"px-4",children:(0,a.jsx)(Z.Z,{size:28,className:"text-indigo-400"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(c.Z,{size:16,className:"text-green-500"})}),(0,a.jsx)("span",{className:"font-bold text-green-600 text-lg",children:i(e.toFamily)})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"应收"})]})]}),(0,a.jsx)("div",{className:"ml-4 px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl shadow-lg",children:(0,a.jsxs)("div",{className:"text-2xl font-bold",children:["\xa5",e.amount.toFixed(2)]})})]},t))})]}):(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8 text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 mx-auto bg-gradient-to-br from-green-100 to-emerald-100 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(E.Z,{size:40,className:"text-green-500"})}),(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"已结清！"}),(0,a.jsx)("p",{className:"text-gray-500",children:"所有 Family 收支平衡，无需结算"})]}),(0,a.jsxs)("div",{className:"bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-2xl p-5",children:[(0,a.jsx)("h4",{className:"font-bold text-amber-800 mb-3 flex items-center gap-2",children:"\uD83D\uDCA1 结算说明"}),(0,a.jsxs)("ul",{className:"text-sm text-amber-700 space-y-2",children:[(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-amber-500 mt-1",children:"•"}),(0,a.jsxs)("span",{children:["正数余额表示该 Family 多付了，应该",(0,a.jsx)("strong",{children:"收钱"})]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-amber-500 mt-1",children:"•"}),(0,a.jsxs)("span",{children:["负数余额表示该 Family 少付了，应该",(0,a.jsx)("strong",{children:"付钱"})]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-amber-500 mt-1",children:"•"}),(0,a.jsxs)("span",{children:["结算方案已优化，",(0,a.jsx)("strong",{children:"交易次数最少"})]})]}),(0,a.jsxs)("li",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-amber-500 mt-1",children:"•"}),(0,a.jsx)("span",{children:"金额已四舍五入到分"})]})]})]})]})}let T=new Map;async function O(e,t){let s="".concat(e.toUpperCase(),"_").concat(t.toUpperCase()),a=T.get(s);if(a&&Date.now()-a.timestamp<18e5)return a.rate;try{var r;let a=await fetch("".concat("https://api.exchangerate-api.com/v4/latest","/").concat(e.toUpperCase()));if(!a.ok)throw Error("API 请求失败");let l=await a.json(),i=null===(r=l.rates)||void 0===r?void 0:r[t.toUpperCase()];if(!i)throw Error("不支持的币种");return T.set(s,{rate:i,timestamp:Date.now()}),i}catch(e){return console.error("获取汇率失败:",e),(null==a?void 0:a.rate)||null}}async function R(e,t){return e===t?1:await O(e,t)||1}let P=[{code:"CNY",name:"人民币",symbol:"\xa5"},{code:"JPY",name:"日元",symbol:"\xa5"},{code:"KRW",name:"韩元",symbol:"₩"},{code:"TWD",name:"新台币",symbol:"NT$"},{code:"HKD",name:"港币",symbol:"HK$"},{code:"SGD",name:"新加坡元",symbol:"S$"},{code:"THB",name:"泰铢",symbol:"฿"},{code:"AED",name:"阿联酋迪拉姆",symbol:"د.إ"},{code:"INR",name:"印度卢比",symbol:"₹"},{code:"MYR",name:"马来西亚林吉特",symbol:"RM"},{code:"IDR",name:"印度尼西亚盾",symbol:"Rp"},{code:"VND",name:"越南盾",symbol:"₫"},{code:"USD",name:"美元",symbol:"$"},{code:"CAD",name:"加元",symbol:"C$"},{code:"BRL",name:"巴西雷亚尔",symbol:"R$"},{code:"MXN",name:"墨西哥比索",symbol:"$"},{code:"EUR",name:"欧元",symbol:"€"},{code:"GBP",name:"英镑",symbol:"\xa3"},{code:"CHF",name:"瑞士法郎",symbol:"Fr"},{code:"SEK",name:"瑞典克朗",symbol:"kr"},{code:"NOK",name:"挪威克朗",symbol:"kr"},{code:"DKK",name:"丹麦克朗",symbol:"kr"},{code:"AUD",name:"澳元",symbol:"A$"},{code:"NZD",name:"新西兰元",symbol:"NZ$"},{code:"ZAR",name:"南非兰特",symbol:"R"},{code:"RUB",name:"俄罗斯卢布",symbol:"₽"},{code:"TRY",name:"土耳其里拉",symbol:"₺"}];function _(e){var t;let{onSubmit:s,onCancel:l,initialData:i,participants:n,families:o,baseCurrency:c="CNY"}=e,[x,u]=(0,r.useState)({payerId:(null==i?void 0:i.payerId)||"",amount:(null==i?void 0:i.amount)||"",currency:(null==i?void 0:i.currency)||"CNY",exchangeRate:(null==i?void 0:null===(t=i.exchangeRate)||void 0===t?void 0:t.toString())||"1",description:(null==i?void 0:i.description)||"",category:(null==i?void 0:i.category)||"餐饮",expenseDate:(null==i?void 0:i.expenseDate)||new Date().toISOString().split("T")[0],splitType:(null==i?void 0:i.splitType)||"all",targetFamilyIds:(null==i?void 0:i.targetFamilyIds)||[],targetParticipantIds:(null==i?void 0:i.targetParticipantIds)||[]}),[p,h]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{x.currency&&x.currency!==c?(h(!0),R(x.currency,c).then(e=>{e&&u(t=>({...t,exchangeRate:e})),h(!1)})):u(e=>({...e,exchangeRate:1}))},[x.currency,c]),(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-emerald-500 to-teal-500 p-6 rounded-t-2xl sticky top-0",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[(0,a.jsx)(w.Z,{size:28}),i?"编辑支出":"添加支出"]}),(0,a.jsx)("p",{className:"text-emerald-100 text-sm mt-1",children:"记录这次旅行的花费"})]}),(0,a.jsx)("button",{onClick:l,className:"p-2 hover:bg-white/20 rounded-full transition",children:(0,a.jsx)(m.Z,{size:24,className:"text-white"})})]})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s({...x,amount:parseFloat(x.amount),exchangeRate:parseFloat(x.exchangeRate),amountInBase:parseFloat(x.amount)*parseFloat(x.exchangeRate)})},className:"p-6 space-y-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,a.jsx)(g.Z,{size:16,className:"inline mr-1"}),"支付人 *"]}),(0,a.jsxs)("select",{value:x.payerId,onChange:e=>u({...x,payerId:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-100 transition",required:!0,children:[(0,a.jsx)("option",{value:"",children:"选择支付人"}),n.map(e=>{var t;return(0,a.jsxs)("option",{value:e.id,children:[e.name," ",e.familyId?"(".concat(null===(t=o.find(t=>t.id===e.familyId))||void 0===t?void 0:t.name,")"):""]},e.id)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"金额 *"}),(0,a.jsx)("input",{type:"number",step:"0.01",value:x.amount,onChange:e=>u({...x,amount:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-100 transition",placeholder:"0.00",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"币种"}),(0,a.jsx)("select",{value:x.currency,onChange:e=>u({...x,currency:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-100 transition",children:P.map(e=>(0,a.jsx)("option",{value:e.code,children:e.code},e.code))})]})]}),x.currency!==c&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-blue-800 mb-2",children:["汇率（1 ",x.currency," = ? ",c,"）"]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("input",{type:"number",step:"0.000001",value:x.exchangeRate,onChange:e=>u({...x,exchangeRate:e.target.value}),className:"flex-1 px-4 py-2 border-2 border-blue-200 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition",required:!0}),p&&(0,a.jsx)("span",{className:"text-blue-600 text-sm",children:"\uD83D\uDD04 获取中..."})]}),(0,a.jsxs)("p",{className:"text-xs text-blue-600 mt-2",children:["\uD83D\uDCB1 转换后金额：",(0,a.jsx)("strong",{children:((parseFloat(x.amount)||0)*(parseFloat(x.exchangeRate)||0)).toFixed(2)})," ",c]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"描述 *"}),(0,a.jsx)("input",{type:"text",value:x.description,onChange:e=>u({...x,description:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-100 transition",placeholder:"例如：晚餐、打车、门票",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"类别"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:[{value:"餐饮",icon:"\uD83C\uDF7D️"},{value:"交通",icon:"\uD83D\uDE97"},{value:"住宿",icon:"\uD83C\uDFE8"},{value:"门票",icon:"\uD83C\uDFAB"},{value:"购物",icon:"\uD83D\uDECD️"},{value:"其他",icon:"\uD83D\uDCDD"}].map(e=>(0,a.jsxs)("button",{type:"button",onClick:()=>u({...x,category:e.value}),className:"p-3 rounded-xl border-2 transition ".concat(x.category===e.value?"border-emerald-500 bg-emerald-50 text-emerald-700":"border-gray-200 hover:border-emerald-300"),children:[(0,a.jsx)("div",{className:"text-2xl mb-1",children:e.icon}),(0,a.jsx)("div",{className:"text-sm font-medium",children:e.value})]},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,a.jsx)(d.Z,{size:16,className:"inline mr-1"}),"支出日期"]}),(0,a.jsx)("input",{type:"date",value:x.expenseDate,onChange:e=>u({...x,expenseDate:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-100 transition",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:[(0,a.jsx)(C.Z,{size:16,className:"inline mr-1"}),"分摊方式"]}),(0,a.jsxs)("select",{value:x.splitType,onChange:e=>u({...x,splitType:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:ring-4 focus:ring-emerald-100 transition",children:[(0,a.jsx)("option",{value:"all",children:"\uD83D\uDC65 全体分摊"}),(0,a.jsx)("option",{value:"families",children:"\uD83C\uDFE0 指定 Family"}),(0,a.jsx)("option",{value:"participants",children:"\uD83D\uDC64 指定人员"})]})]}),"families"===x.splitType&&(0,a.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-xl p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-purple-800 mb-3",children:"选择 Family"}),(0,a.jsx)("div",{className:"space-y-2",children:o.map(e=>{var t;return(0,a.jsxs)("label",{className:"flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-purple-100 transition",children:[(0,a.jsx)("input",{type:"checkbox",checked:x.targetFamilyIds.includes(e.id),onChange:t=>{t.target.checked?u({...x,targetFamilyIds:[...x.targetFamilyIds,e.id]}):u({...x,targetFamilyIds:x.targetFamilyIds.filter(t=>t!==e.id)})},className:"w-5 h-5 text-purple-600 rounded focus:ring-purple-500"}),(0,a.jsx)("span",{className:"font-medium text-gray-700",children:e.name}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["(",(null===(t=e.members)||void 0===t?void 0:t.length)||0,"人)"]})]},e.id)})})]}),"participants"===x.splitType&&(0,a.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4",children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-orange-800 mb-3",children:"选择人员"}),(0,a.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:n.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-3 p-3 bg-white rounded-lg cursor-pointer hover:bg-orange-100 transition",children:[(0,a.jsx)("input",{type:"checkbox",checked:x.targetParticipantIds.includes(e.id),onChange:t=>{t.target.checked?u({...x,targetParticipantIds:[...x.targetParticipantIds,e.id]}):u({...x,targetParticipantIds:x.targetParticipantIds.filter(t=>t!==e.id)})},className:"w-5 h-5 text-orange-600 rounded focus:ring-orange-500"}),(0,a.jsx)("span",{className:"font-medium text-gray-700",children:e.name})]},e.id))})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4 sticky bottom-0 bg-white border-t",children:[(0,a.jsx)("button",{type:"button",onClick:l,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition font-semibold",children:"取消"}),(0,a.jsx)("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl hover:from-emerald-600 hover:to-teal-600 transition font-semibold shadow-lg",children:"保存"})]})]})]})})}function B(e){let{onSubmit:t,onCancel:s}=e,[l,i]=(0,r.useState)({name:"",description:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],baseCurrency:"CNY",creatorName:""});return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-500 p-6 rounded-t-2xl",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[(0,a.jsx)(d.Z,{size:28}),"创建新旅行"]}),(0,a.jsx)("p",{className:"text-indigo-100 text-sm mt-1",children:"开始记录你们的旅行支出"})]}),(0,a.jsx)("button",{onClick:s,className:"p-2 hover:bg-white/20 rounded-full transition",children:(0,a.jsx)(m.Z,{size:24,className:"text-white"})})]})}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t(l)},className:"p-6 space-y-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"旅行名称 *"}),(0,a.jsx)("input",{type:"text",value:l.name,onChange:e=>i({...l,name:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition",placeholder:"例如：2026 日本樱花行",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"描述（可选）"}),(0,a.jsx)("textarea",{value:l.description,onChange:e=>i({...l,description:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition",placeholder:"简单描述一下这次旅行...",rows:3})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"开始日期"}),(0,a.jsx)("input",{type:"date",value:l.startDate,onChange:e=>i({...l,startDate:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"结束日期"}),(0,a.jsx)("input",{type:"date",value:l.endDate,onChange:e=>i({...l,endDate:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"基础货币"}),(0,a.jsx)("select",{value:l.baseCurrency,onChange:e=>i({...l,baseCurrency:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition",children:P.map(e=>(0,a.jsxs)("option",{value:e.code,children:[e.code," - ",e.name," (",e.symbol,")"]},e.code))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"你的姓名 *"}),(0,a.jsx)("input",{type:"text",value:l.creatorName,onChange:e=>i({...l,creatorName:e.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:ring-4 focus:ring-indigo-100 transition",placeholder:"用于记录第一笔支出",required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"你将自动成为这次旅行的管理员"})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition font-semibold",children:"取消"}),(0,a.jsx)("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white rounded-xl hover:from-indigo-600 hover:via-purple-600 hover:to-pink-600 transition font-semibold shadow-lg",children:"创建旅行"})]})]})]})})}var U=s(3879);let q="trip_splitter_data";function M(){try{let e=localStorage.getItem(q);if(e)return JSON.parse(e)}catch(e){console.error("读取存储失败:",e)}return{trips:[],participants:{},families:{},expenses:{}}}function Y(e){try{localStorage.setItem(q,JSON.stringify(e))}catch(e){console.error("保存数据失败:",e)}}function L(e,t){let s=M();return s.participants[e]||(s.participants[e]=[]),s.participants[e].push({...t,id:"p_".concat(Date.now())}),Y(s),s}function $(e){let t=M();return{trip:t.trips.find(t=>t.id===e)||null,participants:t.participants[e]||[],families:t.families[e]||[],expenses:t.expenses[e]||[]}}function K(){let[e,t]=(0,r.useState)("list"),[s,l]=(0,r.useState)(null),[i,d]=(0,r.useState)({trip:null,participants:[],families:[],expenses:[]}),[c,x]=(0,r.useState)(!1),[m,u]=(0,r.useState)(null),[p,g]=(0,r.useState)(!1),[h,b]=(0,r.useState)("expenses");(0,r.useEffect)(()=>{console.log("加载数据:",M())},[]);let f=()=>{s&&d($(s.id))};return((0,r.useEffect)(()=>{f()},[s]),"list"===e)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N,{trips:M().trips,onCreateTrip:()=>g(!0),onSelectTrip:e=>{l(e),d($(e.id)),t("detail"),b("expenses")}}),p&&(0,a.jsx)(B,{onSubmit:e=>{let s=function(e){let t=M();return t.trips.push({...e,id:"trip_".concat(Date.now()),createdAt:new Date().toISOString()}),t.participants[e.id]=[],t.families[e.id]=[],t.expenses[e.id]=[],Y(t),t}({...e,baseCurrency:e.baseCurrency||"CNY"});e.creatorName&&L(s.trips[s.trips.length-1].id,{name:e.creatorName,isAdmin:!0,familyId:null}),g(!1),t("list")},onCancel:()=>g(!1)})]}):"detail"===e&&s?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 via-blue-500 to-indigo-600 text-white shadow-lg",children:[(0,a.jsxs)("div",{className:"p-4 flex items-center gap-3",children:[(0,a.jsx)("button",{onClick:()=>t("list"),className:"p-2 hover:bg-white/20 rounded-full transition",children:(0,a.jsx)(U.Z,{size:24})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("h1",{className:"text-xl font-bold flex items-center gap-2",children:[(0,a.jsx)(z.Z,{size:24}),s.name]}),(0,a.jsxs)("p",{className:"text-blue-100 text-sm mt-1",children:["\uD83D\uDCC5 ",new Date(s.startDate).toLocaleDateString("zh-CN")," -"," ",new Date(s.endDate).toLocaleDateString("zh-CN")]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-sm text-blue-100",children:"总支出"}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[i.expenses.reduce((e,t)=>e+(t.amountInBase||0),0).toFixed(0)," ",s.baseCurrency]})]})]}),(0,a.jsxs)("div",{className:"flex border-t border-white/20",children:[(0,a.jsxs)("button",{onClick:()=>b("expenses"),className:"flex-1 py-4 text-center flex items-center justify-center gap-2 transition ".concat("expenses"===h?"bg-white/20 text-white font-semibold":"text-blue-100 hover:bg-white/10"),children:[(0,a.jsx)(z.Z,{size:20}),"支出记录",i.expenses.length>0&&(0,a.jsx)("span",{className:"bg-white/30 px-2 py-0.5 rounded-full text-xs",children:i.expenses.length})]}),(0,a.jsxs)("button",{onClick:()=>b("settlement"),className:"flex-1 py-4 text-center flex items-center justify-center gap-2 transition ".concat("settlement"===h?"bg-white/20 text-white font-semibold":"text-blue-100 hover:bg-white/10"),children:[(0,a.jsx)(o.Z,{size:20}),"结算中心"]}),(0,a.jsxs)("button",{onClick:()=>b("setup"),className:"flex-1 py-4 text-center flex items-center justify-center gap-2 transition ".concat("setup"===h?"bg-white/20 text-white font-semibold":"text-blue-100 hover:bg-white/10"),children:[(0,a.jsx)(C.Z,{size:20}),"人员管理"]})]})]}),(0,a.jsxs)("div",{className:"p-4 max-w-4xl mx-auto",children:["expenses"===h&&(0,a.jsx)(I,{expenses:i.expenses.map(e=>{var t,s,a;return{...e,payerName:(null===(t=i.participants.find(t=>t.id===e.payerId))||void 0===t?void 0:t.name)||"未知",familyName:(null===(s=i.participants.find(t=>t.id===e.payerId))||void 0===s?void 0:s.familyId)?null===(a=i.families.find(t=>{var s;return t.id===(null===(s=i.participants.find(t=>t.id===e.payerId))||void 0===s?void 0:s.familyId)}))||void 0===a?void 0:a.name:null}}),onAddExpense:()=>x(!0),onEditExpense:e=>{u(e),x(!0)},onDeleteExpense:e=>{confirm("确定删除这条支出吗？")&&(!function(e,t){let s=M();s.expenses[e]&&(s.expenses[e]=s.expenses[e].filter(e=>e.id!==t)),Y(s)}(s.id,e),f())}}),"settlement"===h&&(0,a.jsx)(A,{families:i.families,familyBalances:H(i),settlements:function(e){let t=H(e),s=[],a=[],r=[];t.forEach((e,t)=>{e>0?a.push({familyId:t,amount:e}):e<0&&r.push({familyId:t,amount:-e})}),a.sort((e,t)=>t.amount-e.amount),r.sort((e,t)=>t.amount-e.amount);let l=0,i=0;for(;l<a.length&&i<r.length;){let e=a[l],t=r[i],n=Math.min(e.amount,t.amount);n>.01&&s.push({fromFamily:t.familyId,toFamily:e.familyId,amount:Math.round(100*n)/100}),e.amount-=n,t.amount-=n,e.amount<.01&&l++,t.amount<.01&&i++}return s}(i),baseCurrency:s.baseCurrency||"CNY"}),"setup"===h&&(0,a.jsx)(J,{tripData:i,onAddParticipant:(e,t)=>{L(s.id,{name:e,familyId:t,isAdmin:!1}),f()},onAddFamily:e=>{!function(e,t){let s=M();s.families[e]||(s.families[e]=[]),s.families[e].push({...t,id:"f_".concat(Date.now())}),Y(s)}(s.id,{name:e,members:[]}),f()}})]}),c&&(0,a.jsx)(_,{onSubmit:m?e=>{!function(e,t,s){let a=M();if(a.expenses[e]){let r=a.expenses[e].findIndex(e=>e.id===t);-1!==r&&(a.expenses[e][r]={...a.expenses[e][r],...s,updatedAt:new Date().toISOString()})}Y(a)}(s.id,m.id,e),f(),x(!1),u(null)}:e=>{let t=function(e,t){let s=M();s.expenses[e]||(s.expenses[e]=[]);let a=function(e,t){let s={amountDiff:.01,timeDiffMs:6e4};for(let a of e)if(!(Math.abs((a.amountInBase||0)-(t.amountInBase||0))>s.amountDiff)&&a.description===t.description&&a.payerId===t.payerId&&Math.abs(new Date(a.expenseDate||a.createdAt).getTime()-new Date(t.expenseDate||Date.now()).getTime())<=s.timeDiffMs)return a;return null}(s.expenses[e],t),r={...t,id:"e_".concat(Date.now()),createdAt:new Date().toISOString()};return s.expenses[e].push(r),Y(s),{data:s,duplicate:a}}(s.id,e);(!t.duplicate||confirm("⚠️ 发现可能的重复支出：\n".concat(t.duplicate.description,"\n").concat(t.duplicate.amount," ").concat(t.duplicate.currency,"\n确定还要添加吗？")))&&(f(),x(!1))},onCancel:()=>{x(!1),u(null)},initialData:m,participants:i.participants,families:i.families,baseCurrency:s.baseCurrency}),"expenses"===h&&(0,a.jsx)("button",{onClick:()=>x(!0),className:"fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition flex items-center justify-center",children:(0,a.jsx)(n.Z,{size:28})})]}):null}function H(e){let t=new Map;return e.families.forEach(e=>t.set(e.id,0)),e.expenses.forEach(s=>{let a=e.participants.find(e=>e.id===s.payerId);if(!(null==a?void 0:a.familyId))return;let r=t.get(a.familyId)||0;t.set(a.familyId,r+(s.amountInBase||0));let l=[];"all"===s.splitType?l=e.families.map(e=>e.id):"families"===s.splitType&&s.targetFamilyIds&&(l=s.targetFamilyIds);let i=(s.amountInBase||0)/l.length;l.forEach(e=>{let s=t.get(e)||0;t.set(e,s-i)})}),t}function J(e){let{tripData:t,onAddParticipant:s,onAddFamily:l}=e,[i,n]=(0,r.useState)(""),[d,o]=(0,r.useState)(""),[x,m]=(0,r.useState)("");return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[(0,a.jsx)(C.Z,{size:20,className:"text-blue-500"}),"Family 管理"]}),(0,a.jsx)("div",{className:"space-y-3",children:t.families.map(e=>(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-800",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[t.participants.filter(t=>t.familyId===e.id).length," 人"]})]}),(0,a.jsx)(c.Z,{size:20,className:"text-blue-400"})]},e.id))}),(0,a.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:x,onChange:e=>m(e.target.value),placeholder:"Family 名称（如：张家）",className:"flex-1 px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,a.jsx)("button",{onClick:()=>{x.trim()&&(l(x.trim()),m(""))},className:"px-4 py-2 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition",children:"添加"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold text-gray-800 mb-4 flex items-center gap-2",children:[(0,a.jsx)(C.Z,{size:20,className:"text-green-500"}),"参与者管理"]}),(0,a.jsx)("div",{className:"space-y-2",children:t.participants.map(e=>{var s;return(0,a.jsx)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-xl",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-800",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[e.isAdmin?"\uD83D\uDC51 管理员":"成员",e.familyId&&" \xb7 ".concat(null===(s=t.families.find(t=>t.id===e.familyId))||void 0===s?void 0:s.name)]})]})},e.id)})}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,a.jsx)("input",{type:"text",value:i,onChange:e=>n(e.target.value),placeholder:"姓名",className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,a.jsxs)("select",{value:d,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"不属于任何 Family"}),t.families.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("button",{onClick:()=>{i.trim()&&(s(i.trim(),d||null),n(""),o(""))},className:"w-full px-4 py-2 bg-green-500 text-white rounded-xl hover:bg-green-600 transition",children:"添加参与者"})]})]})]})}},4958:function(e,t,s){"use strict";s.d(t,{O:function(){return n},j:function(){return i}});var a=s(7688);let r="https://zrbcxtamglfjarupqkic.supabase.co",l="sb_publishable_B9aae0u1JmEcOybu_E409Q_Z2r9GkDt",i=!!r&&!!l,n=i?(0,a.eI)(r,l):{auth:{getUser:async()=>({data:{user:null},error:null}),getSession:async()=>({data:{session:null},error:null}),onAuthStateChange:()=>({data:{subscription:{unsubscribe:()=>{}}}}),signUp:async()=>({data:null,error:{message:"Supabase not configured"}}),signInWithPassword:async()=>({data:null,error:{message:"Supabase not configured"}}),signOut:async()=>({error:null})},from:()=>({select:()=>({eq:()=>Promise.resolve({data:[],error:null}),insert:()=>Promise.resolve({data:null,error:null}),update:()=>Promise.resolve({data:null,error:null}),delete:()=>Promise.resolve({data:null,error:null})})})}},4108:function(e,t,s){"use strict";s.r(t),s.d(t,{AuthProvider:function(){return c},useAuth:function(){return x}});var a=s(3827),r=s(4090),l=s(4958);async function i(){try{let{error:e}=await l.O.auth.signOut();if(e)throw e;return{success:!0}}catch(e){return{success:!1,error:e.message}}}async function n(){try{let{data:{user:e}}=await l.O.auth.getUser();return e}catch(e){return null}}async function d(){try{let e=await n();if(!e)return null;let{data:t}=await l.O.from("profiles").select("*").eq("id",e.id).single();return t}catch(e){return null}}let o=(0,r.createContext)(void 0);function c(e){let{children:t}=e,[s,n]=(0,r.useState)(null),[c,x]=(0,r.useState)(null),[m,u]=(0,r.useState)(!0);(0,r.useEffect)(()=>{l.O.auth.getSession().then(e=>{var t;let{data:s}=e;n((null===(t=s.session)||void 0===t?void 0:t.user)||null),u(!1)});let{data:{subscription:e}}=l.O.auth.onAuthStateChange(async(e,t)=>{n((null==t?void 0:t.user)||null),(null==t?void 0:t.user)?x(await d()):x(null),u(!1)});return()=>e.unsubscribe()},[]);let p=async(e,t)=>{let{data:s,error:a}=await l.O.auth.signInWithPassword({email:e,password:t});return a?{success:!1,error:a.message}:(n(s.user),{success:!0})},g=async(e,t,s)=>{let{data:a,error:r}=await l.O.auth.signUp({email:e,password:t,options:{data:{full_name:s}}});return r?{success:!1,error:r.message}:(n(a.user),{success:!0})},h=async()=>{await i(),n(null),x(null)};return(0,a.jsx)(o.Provider,{value:{user:s,profile:c,loading:m,signIn:p,signUp:g,signOut:h},children:t})}function x(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},function(e){e.O(0,[688,459,971,69,744],function(){return e(e.s=393)}),_N_E=e.O()}]);